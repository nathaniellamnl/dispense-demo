(this.webpackJsonpdispense=this.webpackJsonpdispense||[]).push([[4],{475:function(e,t,n){"use strict";var a=n(29);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(0)),c=(0,a(n(35)).default)(r.default.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"}),"AddCircle");t.default=c},691:function(e,t,n){e.exports={button:"Button_button__25VVM","button-container":"Button_button-container__1v2wv"}},692:function(e,t,n){e.exports={"icon-container":"TransactionRecord_icon-container__9PZ9A","section-child":"TransactionRecord_section-child__r7ML2",spacer:"TransactionRecord_spacer__1PcQz","record-container":"TransactionRecord_record-container__1gyiH"}},693:function(e,t,n){"use strict";var a=n(29);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(0)),c=(0,a(n(35)).default)(r.default.createElement("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 00-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"}),"Edit");t.default=c},694:function(e,t,n){"use strict";var a=n(29);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(0)),c=(0,a(n(35)).default)(r.default.createElement("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}),"Delete");t.default=c},695:function(e,t,n){"use strict";var a=n(29);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(0)),c=(0,a(n(35)).default)(r.default.createElement("path",{d:"M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"}),"Print");t.default=c},713:function(e,t,n){"use strict";n.r(t);var a=n(16),r=n(52),c=n(8),i=n(0),o=n.n(i),l=n(273),s=n(274),u=n(283),d=n(277),m=n(1),f=n(2),h=(n(5),n(3)),p=n(4),b=i.forwardRef((function(e,t){var n=e.classes,a=e.className,r=e.component,c=void 0===r?"div":r,o=Object(f.a)(e,["classes","className","component"]);return i.createElement(c,Object(m.a)({ref:t,className:Object(h.a)(n.root,a)},o))})),v=Object(p.a)({root:{width:"100%",overflowX:"auto"}},{name:"MuiTableContainer"})(b),E=n(275),g=n(276),y=n(282),_=n(475),j=n.n(_),O=n(695),I=n.n(O),k=n(693),w=n.n(k),D=n(694),S=n.n(D),T=n(235),C=n(36),z=n(691),M=n.n(z),N=function(e){return o.a.createElement("section",{className:M.a["button-container"]},e.buttonNames.map((function(t){return o.a.createElement("button",{onClick:"Cancel"===t?e.cancel:e.action,key:t,className:M.a.button,type:"button"},t)})))},P=n(21),H=n(103),A=n(692),q=n.n(A),V=o.a.lazy((function(){return Promise.all([n.e(7),n.e(6)]).then(n.bind(null,714))})),x=Object(l.a)({table:{minWidth:400}});t.default=function(e){var t=x(),n=Object(i.useState)({open:!1,transactionId:null}),l=Object(c.a)(n,2),m=l[0],f=l[1],h=Object(i.useState)({open:!1,transactionId:null}),p=Object(c.a)(h,2),b=p[0],_=p[1],O=Object(i.useState)(),k=Object(c.a)(O,2),D=k[0],z=k[1],M=Object(i.useState)(!1),A=Object(c.a)(M,2),F=A[0],R=A[1],B=Object(i.useState)(0),J=Object(c.a)(B,2),L=J[0],$=J[1],Q=function(e){f({open:!0,transactionId:e})},U=function(){f({open:!1,transactionId:null})},W=function(){_({open:!1,transactionId:null})};Object(i.useEffect)((function(){var t={query:"\n                 query Transactions($id:ID) {\n                   transactions(_id:$id) {\n                    _id\n                    transactionDate\n                    drugs\n                    quantities\n                    remark\n                    amount\n                   }\n                 }\n              ",variables:{id:e.patientId}};fetch(P.graphqlServerUrl,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("dispenseToken")}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed");return e.json()})).then((function(e){z(e.data.transactions)})).catch((function(e){}))}),[e]),Object(i.useEffect)((function(){if(D){var e=0;D.map((function(t){e=Math.max(e,t.drugs.length)})),$(e)}}),[D]);var X=function(e,t,n){var c=Object(r.a)(D);switch(e){case"delete":var i=c.findIndex((function(e){return e._id===t}));c.splice(i,1),z(c);break;case"update":var o=c.findIndex((function(e){return e._id===t}));c[o]=Object(a.a)({},n),c.sort((function(e,t){return new Date(t.transactionDate)-new Date(e.transactionDate)})),z(c);break;case"create":c.push(Object(a.a)({},n)),c.sort((function(e,t){return new Date(t.transactionDate)-new Date(e.transactionDate)})),z(c)}};return o.a.createElement(i.Fragment,null,o.a.createElement("div",{className:q.a["record-container"]},o.a.createElement("h2",null,e.patientInfo[0].caseCode+" "+e.patientInfo[0].chineseName+"("+e.patientInfo[0].englishName+")"),o.a.createElement(H.a,{show:m.open,modalClosed:U},o.a.createElement(i.Suspense,{fallback:o.a.createElement("div",null,"Loading...")},o.a.createElement(V,{token:localStorage.getItem("dispenseToken"),cancelModal:U,patientId:e.patientId,transactionId:m.transactionId,entryChangeHandler:X}))),o.a.createElement(H.a,{show:b.open,modalClosed:W},F?o.a.createElement(C.a,null):o.a.createElement(i.Fragment,null,o.a.createElement("p",{style:{fontSize:"large"}},"Are you sure you want to delete this transaction entry?"),o.a.createElement(N,{buttonNames:["Delete","Cancel"],action:function(){var e={query:"\n                 mutation DeleteTransaction($transactionId:ID!) {\n                   deleteTransaction(_id:$transactionId)\n                 }\n              ",variables:{transactionId:b.transactionId}};R(!0),fetch(P.graphqlServerUrl,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("dispenseToken")}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed");return e.json()})).then((function(e){R(!1),W(),X("delete",b.transactionId,null)})).catch((function(e){alert(e),R(!1)}))},cancel:W}))),o.a.createElement("div",{className:q.a["icon-container"]},o.a.createElement(T.a,{onClick:function(){return Q(null)}},o.a.createElement(j.a,{style:{fill:"green",cursor:"pointer"}})),o.a.createElement("span",null,"Add new entry")),D&&0===D.length?o.a.createElement("p",null,"The patient does not have any transaction record."):o.a.createElement(v,{component:y.a,style:{maxHeight:450}},o.a.createElement(s.a,{stickyHeader:!0,className:t.table,"aria-label":"simple table"},o.a.createElement(E.a,null,o.a.createElement(g.a,null,o.a.createElement(d.a,{align:"center"},"Edit"),o.a.createElement(d.a,{align:"center"},"Print"),Object(r.a)(Array(L)).map((function(e,t){return o.a.createElement(i.Fragment,{key:t},o.a.createElement(d.a,{align:"right"},"Drug\xa0Item\xa0",t+1),o.a.createElement(d.a,{align:"right"},"Drug\xa0Item\xa0",t+1,"\xa0Qty"))})),o.a.createElement(d.a,{align:"right"},"Paid\xa0Amount\xa0"),o.a.createElement(d.a,{align:"right"},"Transaction\xa0Date\xa0"))),o.a.createElement(u.a,null,D?D.map((function(e,t){return o.a.createElement(g.a,{key:e._id,style:t%2?{background:"#e9e9e9"}:{background:"white"}},o.a.createElement(d.a,{align:"center"},o.a.createElement(T.a,{onClick:function(){return Q(e._id)}},o.a.createElement(w.a,{style:{fill:"#1053ab",cursor:"pointer"}})),o.a.createElement(T.a,{onClick:function(){return t=e._id,void _({open:!0,transactionId:t});var t}},o.a.createElement(S.a,{style:{fill:"black",cursor:"pointer"}}))),o.a.createElement(d.a,{align:"center"},o.a.createElement(T.a,{onClick:function(){return t=e._id,void window.open("/print/"+t,"_blank","noopener,noreferrer");var t}},o.a.createElement(I.a,{style:{fill:"#ab9910",cursor:"pointer"}}))),Object(r.a)(Array(L)).map((function(t,n){return o.a.createElement(i.Fragment,{key:n},o.a.createElement(d.a,{align:"right"},n>=e.drugs?null:e.drugs[n]),o.a.createElement(d.a,{align:"right"},n>=e.quantities?null:e.quantities[n]))})),o.a.createElement(d.a,{align:"right"},e.amount),o.a.createElement(d.a,{align:"right"},e.transactionDate.substring(0,10)))})):null)))))}}}]);
//# sourceMappingURL=4.8d65d308.chunk.js.map