(this.webpackJsonpdispense=this.webpackJsonpdispense||[]).push([[5],{696:function(e,t,n){e.exports={"icon-container":"TransactionRecord_icon-container__9PZ9A","section-child":"TransactionRecord_section-child__r7ML2",spacer:"TransactionRecord_spacer__1PcQz","record-container":"TransactionRecord_record-container__1gyiH"}},697:function(e,t,n){"use strict";var a=n(22);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(0)),i=(0,a(n(23)).default)(r.default.createElement("path",{d:"M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"}),"Print");t.default=i},709:function(e,t,n){"use strict";n.r(t);var a=n(9),r=n(43),i=n(39),c=n(7),l=n(0),o=n.n(l),s=n(125),u=n(245),d=n(243),m=n(291),f=n(292),p=n(248),b=n(102),h=n(105),g=n.n(h),E=n(697),v=n.n(E),y=n(126),I=n.n(y),j=n(127),O=n.n(j),_=n(25),k=n(124),w=n(17),S=n(54),T=n(696),C=n.n(T),A=o.a.lazy((function(){return Promise.all([n.e(6),n.e(7)]).then(n.bind(null,698))}));Object(u.a)({table:{minWidth:400}});t.default=function(e){var t=Object(l.useState)({open:!1,transactionId:null}),n=Object(c.a)(t,2),u=n[0],h=n[1],E=Object(l.useState)({open:!1,transactionId:null}),y=Object(c.a)(E,2),j=y[0],T=y[1],D=Object(l.useState)(),P=Object(c.a)(D,2),z=P[0],q=P[1],N=Object(l.useState)(!1),H=Object(c.a)(N,2),F=H[0],M=H[1],x=Object(l.useState)(0),J=Object(c.a)(x,2),Q=J[0],R=J[1],$=Object(l.useState)({fn:function(e){return e},value:null}),B=Object(c.a)($,2),L=B[0],U=(B[1],[{id:"edit",label:"Edit",disableSorting:!0},{id:"print",label:"print",disableSorting:!0},Object(i.a)(Array(Q)).map((function(e,t){var n,a="drugItem"+ +(t+1),i="drugQty"+ +(t+1);return n={},Object(r.a)(n,a,{id:"drugItem"+ +(t+1),label:"Drug Item "+ +(t+1)}),Object(r.a)(n,i,{id:"drugQty"+ +(t+1),label:"Drug Qty "+ +(t+1)}),n})),{id:"amount",label:"Paid Amount"},{id:"transactionDate",label:"Transaction Date"}]),V=Object(s.a)(z,U,L,[1,2,3]),W=V.TblContainer,Z=V.TblHead,G=V.TblPagination,K=V.recordsAfterPaginationAndSorting,X=function(e){h({open:!0,transactionId:e})},Y=function(){h({open:!1,transactionId:null})},ee=function(){T({open:!1,transactionId:null})};Object(l.useEffect)((function(){var t={query:"\n                 query Transactions($id:ID) {\n                   transactions(_id:$id) {\n                    _id\n                    transactionDate\n                    drugs\n                    quantities\n                    remark\n                    amount\n                   }\n                 }\n              ",variables:{id:e.patientId}};fetch(w.graphqlServerUrl,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("dispenseToken")}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed");return e.json()})).then((function(e){console.log(e.data.transactions),e.data.transactions.map((function(e){e.amount=+e.amount})),q(e.data.transactions)})).catch((function(e){alert(e)}))}),[e]),Object(l.useEffect)((function(){if(z){var e=0;z.map((function(t){e=Math.max(e,t.drugs.length)})),R(e)}}),[z]);var te=function(e,t,n){var r=Object(i.a)(z);switch(e){case"delete":var c=r.findIndex((function(e){return e._id===t}));r.splice(c,1),q(r);break;case"update":var l=r.findIndex((function(e){return e._id===t}));r[l]=Object(a.a)({},n),q(r);break;case"create":r.push(Object(a.a)({},n)),console.log(r),q(r)}};return o.a.createElement(l.Fragment,null,o.a.createElement("div",{className:C.a["record-container"]},o.a.createElement("h2",null,e.patientInfo[0].caseCode+" "+e.patientInfo[0].chineseName+"("+e.patientInfo[0].englishName+")"),o.a.createElement(S.a,{show:u.open,modalClosed:Y},o.a.createElement(l.Suspense,{fallback:o.a.createElement("div",null,"Loading...")},o.a.createElement(A,{token:localStorage.getItem("dispenseToken"),cancelModal:Y,patientId:e.patientId,transactionId:u.transactionId,entryChangeHandler:te}))),o.a.createElement(S.a,{show:j.open,modalClosed:ee},F?o.a.createElement(_.a,null):o.a.createElement(l.Fragment,null,o.a.createElement("p",{style:{fontSize:"large"}},"Are you sure you want to delete this transaction entry?"),o.a.createElement(k.a,{buttonNames:["Delete","Cancel"],action:function(){var e={query:"\n                 mutation DeleteTransaction($transactionId:ID!) {\n                   deleteTransaction(_id:$transactionId)\n                 }\n              ",variables:{transactionId:j.transactionId}};M(!0),fetch(w.graphqlServerUrl,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("dispenseToken")}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed");return e.json()})).then((function(e){M(!1),ee(),te("delete",j.transactionId,null)})).catch((function(e){alert(e),M(!1)}))},cancel:ee}))),o.a.createElement("div",{className:C.a["icon-container"]},o.a.createElement(d.a,{onClick:function(){return X(null)}},o.a.createElement(g.a,{style:{fill:"green",cursor:"pointer"}})),o.a.createElement("span",null,"Add new entry")),z&&0===z.length?o.a.createElement("p",null,"The patient does not have any transaction record."):o.a.createElement(m.a,null,o.a.createElement(W,null,o.a.createElement(Z,null),o.a.createElement(f.a,null,z?K().map((function(e,t){return o.a.createElement(p.a,{key:e._id,style:t%2?{background:"#e9e9e9"}:{background:"white"}},o.a.createElement(b.a,{align:"left",width:"20%"},o.a.createElement(d.a,{onClick:function(){return X(e._id)}},o.a.createElement(I.a,{style:{fill:"#1053ab",cursor:"pointer"}})),o.a.createElement(d.a,{onClick:function(){return t=e._id,void T({open:!0,transactionId:t});var t}},o.a.createElement(O.a,{style:{fill:"black",cursor:"pointer"}}))),o.a.createElement(b.a,{align:"left",width:"20%"},o.a.createElement(d.a,{onClick:function(){return t=e._id,void window.open("/print/"+t,"_blank","noopener,noreferrer");var t}},o.a.createElement(v.a,{style:{fill:"#ab9910",cursor:"pointer"}}))),Object(i.a)(Array(Q)).map((function(t,n){return o.a.createElement(l.Fragment,{key:n},o.a.createElement(b.a,{align:"left",width:"10%"},n>=e.drugs?null:e.drugs[n]),o.a.createElement(b.a,{align:"left",width:"10%"},n>=e.quantities?null:e.quantities[n]))})),o.a.createElement(b.a,{align:"left",width:"20%"},e.amount),o.a.createElement(b.a,{align:"left",width:"20%"},e.transactionDate.substring(0,10)))})):null)),o.a.createElement(G,null))))}}}]);
//# sourceMappingURL=5.dd77a661.chunk.js.map