(this.webpackJsonpdispense=this.webpackJsonpdispense||[]).push([[7],{700:function(t,e,a){"use strict";a.r(e);var n=a(43),r=a(39),i=a(9),c=a(701),o=a(7),s=a(0),u=a.n(s),l=a(301),m=a(713),d=a(106),g=a.n(d),p=a(704),f=a.n(p),b=a(245),h=a(17),y=a(702),E=a.n(y),O=a(24);e.default=function(t){var e=Object(s.useState)({transactionDate:!1,drugs:[!1],quantities:[!1],amount:!1}),a=Object(o.a)(e,2),d=a[0],p=a[1],y=Object(s.useState)(!0),v=Object(o.a)(y,2),j=v[0],_=v[1],I=Object(s.useState)([{_id:"",name:"",price:"",quantity:""}]),q=Object(o.a)(I,2),D=q[0],T=q[1],S=function(t,e){var a=0;console.log("Calculate: "+D);for(var n=0;n<t.length;n++){var r,i=Object(c.a)(D);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(o.name===t[n]&&e){a+=o.price*e[n];break}}}catch(s){i.e(s)}finally{i.f()}}return a},k=Object(s.useReducer)((function(t,e){switch(e.type){case"Initialize":return Object(i.a)(Object(i.a)({},t),e.transaction);case"Submit":return Object(i.a)(Object(i.a)({},t),{},{amount:e.amount});case"Calculate":return Object(i.a)(Object(i.a)({},t),{},{quantities:e.quantities,drugs:e.drugs,amount:S(e.drugs,e.quantities)});case"Update":return Object(i.a)({},e.currentState);case"AddItem":var a=Object(r.a)(t.quantities);a.push("");var n=Object(r.a)(t.drugs);return n.push(""),Object(i.a)(Object(i.a)({},t),{},{quantities:a,drugs:n});case"DeleteItem":var c=Object(r.a)(t.quantities);c.splice(e.index,1);var o=Object(r.a)(t.drugs);return o.splice(e.index,1),Object(i.a)(Object(i.a)({},t),{},{quantities:c,drugs:o,amount:S(o,c)});case"Reset":return{transactionDate:"",drugs:[""],quantities:[""],remark:"",amount:""};default:throw new Error("Should not get there!")}}),{transactionDate:"",drugs:[""],quantities:[null],remark:"",amount:""}),$=Object(o.a)(k,2),w=$[0],C=$[1];Object(s.useEffect)((function(){if(_(!0),t.transactionId){var e={query:"\n                     query Transactions($id:ID) {\n                       transactions(_id:$id) {\n                        _id\n                        transactionDate\n                        drugs\n                        quantities\n                        remark\n                        amount\n                       }\n                       drugs {\n                           _id\n                           name\n                           price\n                       }\n                     }\n                  ",variables:{id:t.transactionId}};fetch(h.graphqlServerUrl,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("dispenseToken")}}).then((function(t){if(200!==t.status&&201!==t.status)throw new Error("Failed");return t.json()})).then((function(t){C({type:"Initialize",transaction:Object(i.a)(Object(i.a)({},t.data.transactions[0]),{},{transactionDate:t.data.transactions[0].transactionDate.substring(0,10)})}),T(t.data.drugs),_(!1)})).catch((function(t){_(!1)}))}else{_(!0);fetch(h.graphqlServerUrl,{method:"POST",body:JSON.stringify({query:"\n                     query {\n                       drugs {\n                           _id\n                           name\n                           price\n                       }\n                     }\n                  "}),headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("dispenseToken")}}).then((function(t){if(200!==t.status&&201!==t.status)throw new Error("Failed");return t.json()})).then((function(t){T(t.data.drugs),C({type:"Reset"}),_(!1)})).catch((function(t){_(!1)}))}p({transactionDate:!1,amount:!1,drugs:[!1],quantities:[!1]})}),[t]);var N=function(t){return!t||""===t},F=function(){var t,e=[],a=[],n=Object(c.a)(w.drugs);try{for(n.s();!(t=n.n()).done;){t.value;e.push(!1),a.push(!1)}}catch(r){n.e(r)}finally{n.f()}p({transactionDate:!1,drugs:e,quantities:a,amount:!1})},U=function(t,e){C({type:"Update",currentState:Object(i.a)(Object(i.a)({},w),{},Object(n.a)({},e,t.target.value?t.target.value:""))}),F()};return u.a.createElement(s.Fragment,null,j?u.a.createElement(O.a,null):u.a.createElement("form",{onSubmit:function(e){e.preventDefault();var a,n=!1,r=[],o=[],s=Object(c.a)(w.drugs);try{for(s.s();!(a=s.n()).done;){var u=a.value;n=n||N(u),r.push(N(u))}}catch(f){s.e(f)}finally{s.f()}var l,m=Object(c.a)(w.quantities);try{for(m.s();!(l=m.n()).done;){var d=l.value;n=n||N(d),o.push(N(d))}}catch(f){m.e(f)}finally{m.f()}if(n=n||N(w.transactionDate))p({drugs:r,quantities:o,amount:!1,transactionDate:N(w.transactionDate)});else{var g={query:t.transactionId?'  \n            mutation UpdateTransaction($transactionId: ID!,$drugs: [String!]!,$quantities: [Int!]! ,$id:ID!,$amount: Float!, $remark:String){\n               updateTransaction(\n                    _id: $transactionId,\n                   transactionInput:{\n                       transactionDate: "'.concat(new Date(w.transactionDate).toISOString(),'",\n                       drugs:$drugs,\n                       quantities:$quantities,\n                       patientId: $id, \n                       amount: $amount,\n                       remark:$remark\n                     }\n               ) {\n                  transactionDate\n              }\n            }\n         '):'  \n            mutation CreateTransaction($drugs: [String!]!,$quantities: [Int!]! ,$id:ID!,$amount: Float!,$remark:String){\n               createTransaction(\n                   transactionInput:{\n                       transactionDate: "'.concat(new Date(w.transactionDate).toISOString(),'",\n                       drugs:$drugs,\n                       quantities:$quantities,\n                       patientId: $id, \n                       amount: $amount,\n                       remark:$remark\n                     }\n               ) \n            }\n         '),variables:{drugs:w.drugs,quantities:w.quantities,id:t.patientId,amount:+w.amount,transactionId:t.transactionId,remark:w.remark}};_(!0),fetch(h.graphqlServerUrl,{method:"POST",body:JSON.stringify(g),headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("dispenseToken")}}).then((function(t){if(200!==t.status&&201!==t.status)throw new Error("Failed");return t.json()})).then((function(e){e.errors?(_(!1),console.log(e.errors),alert("An unexpected error occured!")):(console.log(e.data.createTransaction),_(!1),t.cancelModal(),t.transactionId?t.entryChangeHandler("update",t.transactionId,Object(i.a)(Object(i.a)({},w),{},{transactionDate:new Date(w.transactionDate).toISOString()})):t.entryChangeHandler("create",null,Object(i.a)(Object(i.a)({},w),{},{_id:e.data.createTransaction,transactionDate:new Date(w.transactionDate).toISOString()})))})).catch((function(t){_(!1),alert("An unexpected error occured.")}))}},className:E.a.form},u.a.createElement("section",null,u.a.createElement("label",{htmlFor:"transactionDate"},"Transaction Date:"),u.a.createElement("input",{className:d.transactionDate?[E.a.error,E.a.spacer].join(" "):E.a.spacer,onChange:function(t){return U(t,"transactionDate")},value:w.transactionDate?w.transactionDate:"",type:"date",id:"transactionDate",name:"transactionDate"})),function(){for(var t=[],e=function(e){t.push(u.a.createElement(s.Fragment,{key:"fragment"+e},u.a.createElement("section",{className:E.a["section-container"]},u.a.createElement("div",null,u.a.createElement(m.a,{value:w.drugs?{name:w.drugs[e-1]}:{id:"",name:"",price:"",quantity:""},onChange:function(t,a){return function(t,e){var a=Object(r.a)(w.drugs);a[t-1]=e?e.name:"",C({type:"Calculate",drugs:a,quantities:w.quantities}),F()}(e,a)},id:"drugItem"+e,options:Array.isArray(D)?[].concat(Object(r.a)(D),[{id:"",name:"",price:"",quantity:""}]):[{id:"",name:"",price:""}],getOptionLabel:function(t){return t.name},style:{width:400,height:50},renderInput:function(t){return u.a.createElement(l.a,Object.assign({},t,{label:"Drug Item "+e,variant:"outlined",name:"drugItem"+e,error:d.drugs[e-1]}))}})),u.a.createElement("div",{className:E.a.spacer}),u.a.createElement("div",{className:E.a["section-chlid--vertical"]},u.a.createElement("label",{htmlFor:"drugItem"+e+"Unit"},"Drug Item ",e," Quantity:"),u.a.createElement("input",{className:d.quantities[e-1]?E.a.error:null,onChange:function(t){return function(t,e){var a=Object(r.a)(w.quantities);a[t-1]=e.target.value?parseInt(e.target.value):"",C({type:"Calculate",drugs:w.drugs,quantities:a}),F()}(e,t)},value:w.quantities?w.quantities[e-1]:"",type:"number",id:"drugItem"+e+"Unit",name:"drugItem"+e+"Unit"}),u.a.createElement("div",null,"Unit(s)")),u.a.createElement("div",{className:E.a.spacer}),1===e?null:u.a.createElement("section",{className:E.a["icon-container"]},u.a.createElement(b.a,{onClick:function(){C({type:"DeleteItem",index:e-1})}},u.a.createElement(f.a,{style:{fill:"red",cursor:"pointer"}})),u.a.createElement("span",null,"Remove drug item"))),u.a.createElement("hr",{style:{marginTop:10}})))},a=1;a<=w.drugs.length;a++)e(a);return t}(),u.a.createElement("section",{className:E.a["icon-container"]},u.a.createElement(b.a,{onClick:function(){C({type:"AddItem"})}},u.a.createElement(g.a,{style:{fill:"green",cursor:"pointer"}})),u.a.createElement("span",null,"Add new drug item")),u.a.createElement("section",{className:E.a["remark-container"]},u.a.createElement("label",{htmlFor:"remark"},"Remark:"),u.a.createElement("textarea",{onChange:function(t){return U(t,"remark")},value:w.remark?w.remark:"",style:{resize:"none"},className:E.a.spacer,rows:"3",cols:"60",id:"remark",name:"remark"})),u.a.createElement("section",{className:E.a["amount-container"]},u.a.createElement("label",{htmlFor:"amount"},"Total paid amount:"),u.a.createElement("input",Object(n.a)({className:d.amount?[E.a.error,E.a.spacer].join(" "):E.a.spacer,onChange:function(t){return U(t,"amount")},value:w.amount,name:"amount",type:"number",id:"amount"},"name","amount")),u.a.createElement("div",null),u.a.createElement("span",null,"(You can modify the amount as some customers might accidentally have paid a wrong amonut)")),u.a.createElement("section",{className:E.a["button-container"]},u.a.createElement("button",{className:E.a.button,type:"submit"},t.transactionId?"Update":"Create"))))}},702:function(t,e,a){t.exports={form:"TransactionEntry_form__2acg5","icon-container":"TransactionEntry_icon-container__2K5OV","section-container":"TransactionEntry_section-container__20aXg","section-chlid--vertical":"TransactionEntry_section-chlid--vertical__2VkGX",spacer:"TransactionEntry_spacer__2Onyb","remark-container":"TransactionEntry_remark-container__XTYce","amount-container":"TransactionEntry_amount-container__3iFGf","div-container--horiz":"TransactionEntry_div-container--horiz__K_FRf","input--long":"TransactionEntry_input--long__1ebhG",button:"TransactionEntry_button__WZ9TI","button-container":"TransactionEntry_button-container__1xgQJ",error:"TransactionEntry_error__oVejP","error-text":"TransactionEntry_error-text__3f7EQ"}}}]);
//# sourceMappingURL=7.64bf4529.chunk.js.map